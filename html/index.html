<html>
  <head>
    <link href="https://cdn.quilljs.com/1.3.4/quill.snow.css" rel="stylesheet">
      <link href="../css/quillcss.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.4/quill.js"></script>
    <script  type="text/javascript" src="../javascript/quilljs.js"></script>
    <script src="../js_library/jquery.min.js" type="text/javascript"></script>
      <script src="../js_library/jquery-ui.js" type="text/javascript"></script>
        <script src="../js_library/knockout-min.js" type="text/javascript"></script>
      <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.17/themes/base/jquery-ui.css">
  </head>
  <body>


     <div id="editor"></div>
      <button id ="submit" onclick="logHtmlContent()">Submit</button>
      <div class="lookahead-div">
                              <ul class="sf-menu" id="example" >
                                    <li class="loadlook-div" class="current">
                                          <a href="javascript:void(0);" data-bind="loadLookahead">Lookahead Information &#9660;</a>

                                          <ul data-bind="foreach: lookaheadObject">
                                                <li class="current">
                                                      <a href="javascript:void(0);" data-bind="text:cat"> </a>
                                                      <ul data-bind="foreach: wfm">
                                                            <li>
                                                                  <a href="javascript:void(0);" data-bind="text:$data, click: $root.postWordClicked"> </a>
                                                            </li>
                                                      </ul>
                                                </li>
                                          </ul>
                                    </li>

                                    <li class="current">
                                                                        <a href="javascript:void(0);" >Anaphoric Expressions &#9660;</a>

                                                                        <ul data-bind="foreach: anaExp">
                                                                              <li>
                                                                                    <a href="javascript:void(0);" data-bind="text:$data, click: $root.postAnaExpClicked"> </a>
                                                                              </li>
                                                                        </ul>

                                                                  </li>

                                  </ul>
                                    </div>



  </body>
</html>

<script>
  var toolbarOptions = [
    ['bold', 'italic'],
    [{ 'size': ['small', false, 'large', 'huge'] }],
    [{ 'color': [] }, { 'background': [] }]
  ]
  var quill = new Quill('#editor', {
    modules: {
      toolbar: toolbarOptions
    },
    theme: 'snow'
  });
  function logHtmlContent() {
    console.log(quill.root.innerHTML);
  }


  $(('#submit')).on('click',function(){

    $.ajax({
      type:'POST',
      url:"/peng",
      data:'json',
      success:function(){
        console.log("success");
      },
      error: function ()
                  {
                        alert("Failed JSON object input when loading file: \n "+errorThrown);
                  },
                });

$( "#editor" ).empty();

              })



              $( "#editor" ).mousedown(function() {
  alert( "Handler for .mousedown() called." );
});

(function($){ //create closure so we can safely use $ as alias for jQuery

      $(document).ready(function(){
            // initialise plugin


            // buttons to demonstrate Superfish's public methods
            $('.destroy').on('click', function() {
                  example.superfish('destroy');
            });



      });

})(jQuery);

/**
*  Lookahead object
*/


var Lookahead = {

      wordTable: [],    // table for words for current token
      cats: [], //categories
      wfms: [],
      vforms: [],
      nums: [],
      catsCanAdd: ["intransitive verb", "transitive verb", "name", "count noun", "mass noun", "adjective", "adverb"],


      getWordTable: function() {
            return this.wordTable;
      },

      emptyAll: function() {
            this.wordTable = [];
            this.cats = [];
            this.wfms = [];
            this.vforms = [];
            this.nums =  [];
      },

      // sets cats, wfm, vform, num into their own list, assuming they exist
      setAll: function (data) {
            this.emptyAll();

            if (data.hasOwnProperty('lookahead')) {
                  var numOfCat = data.lookahead.length;  //number of categories avaialble
                  for (i = 0; i < numOfCat; i++) {

                        this.cats.push(data.lookahead[i].cat);

                        this.wfms.push(data.lookahead[i].wfm);
                        if (data.lookahead[i].hasOwnProperty('vform'))
                              this.vforms.push(data.lookahead[i].vform);
                        else
                              this.vforms.push(" ");

                        if (data.lookahead[i].hasOwnProperty('num'))
                              this.nums.push(data.lookahead[i].num);
                        else
                              this.nums.push(" ");

                  }


                  var temp = [];
                  for (i = 0; i < this.wfms.length; i++) {
                        for (j = 0; j < this.wfms[i].length; j++) {

                              temp.push(this.wfms[i][j][0]);
                        }
                  }
                  //remove duplicates of word table
                  var temp2 = [];
                  $.each(temp, function(i, el) {
                        if($.inArray(el, temp2) === -1)  temp2.push(el);
                  });
                  this.wordTable = temp2;
            }
            else {

            }
      },

      // Removes all values in a lookahead table that does not correspond with token  (@ a node level).
      filterTable: function(token, lookahead) {
            for (i = 0; i < lookahead.length; i++) { //CHANGE TO FILTER
                  var notSameString = token != lookahead[i].slice(0, token.length);
                  if (notSameString) {
                        lookahead.splice(i, 1);
                        i--;
                  }
            }
            return lookahead;
      },

      /**
      *     lookahead: JSON object from PENG server
      *     return: an array containing lookahead data containing {cat, wfm}
      */
      createLookaheadTable: function(lookahead) {
            var wfm = [];
            var temp = [];
            for(i = 0; i < lookahead.cats.length; i++) {
                  var wfm = [];
                  for(j = 0; j < lookahead.wfms[i].length; j++) {
                        var word = lookahead.wfms[i][j].join(" ");
                        wfm.push(word);
                  }
                  temp.push({"cat": lookahead.cats[i], "wfm": wfm});
            }
            return temp;
      },

      /**
      *     lookahead: JSON object from PENG server
      *     return: an array containing lookahead data containing {cat, wfm}
      */
      createCatTable: function(lookahead) {
            var wfm = [];
            var temp = [];
            for(i = 0; i < lookahead.cats.length; i++) {
                  var wfm = [];
                  for(j = 0; j < lookahead.wfms[i].length; j++)
                        wfm.push(lookahead.wfms[i][j][0]);
                  temp.push(wfm);
            }
            return temp;
      },

      /**
      * Return: an array with str inserted in the head of wfm
      */
      addStrInHeadForEachCatInLookahead: function(str, lookaheadObject) {
            var catArr = ["intransitive verb", "transitive verb", "name", "count noun", "mass noun", "adjective", "adverb"];
            for(i = 0; i < lookaheadObject.length; i++) {
                  if(catArr.includes(lookaheadObject[i].cat)) {
                        if (lookaheadObject[i].cat != "name" && textLineData.nodes[textLineData.nodes.length-2] != " ") {
                              str = str.toLowerCase();
                        }
                        lookaheadObject[i].wfm.unshift("Add: "+str);
                  }
            }
            return lookaheadObject;
      },


}


var textLineData = {
  nodes: [],
  sentences: [],
  sposNum: 0,
  firstIndexOfSentence: 0,


  createNode: function(word, rmode) {
      //  var _spos = this.nodes.length-this.firstIndexOfSentence > 1 ? this.nodes.length-this.firstIndexOfSentence-1 : 0;
    var idNum = this.nodes.length+1;
    var ajaxStruct = {
      id: idNum, //ID starts at 1
      inputmode:"text", //inputMode, //"text" ------ FIX
      editmode:"parse", //"parse" ----- FIX
      token: word == "" ? " " : word, // the word itself
      nbest:"[]", // words, supposed to show most likely result (SPEECH MODE)
      featurestructure:"{ \"cat\" : \" \",  \"wfm\" : \" \"}",
      filename:" ", //when loading
      spectext: " ", //
      snum: this.sentences.length+1,

      spos: this.getSpos(), //
      reasoner: (word == "." || word == "?") ? "on" : "off", // on or off
      reasonermode: rmode
    };

    this.addNode(word);

   // this.addNode(word);
    return ajaxStruct;
  },

  addNode: function(node) {
    this.nodes.push(node);

    this.sposNum = node == " " ? 0 : this.sposNum + 1;

  },

addSentence: function(sentence) {
  //  while(event.charCode==13 || document.getElementById("addButton-id").clicked == true)
    //{
    this.sentences.push(sentence);
  //  this.sentences.push(sentence2);
    this.firstIndexOfSentence = this.nodes.length;
  //  this.sentences.push(sentence2);
  //  this.firstIndexOfSentence = this.nodes.length;

  //this.firstIndexofSentence = this.sentence.length;
},



  removeTailNode: function() {

    return this.nodes.pop();
  },

  getSpos: function() {
      if(this.nodes.length-this.firstIndexOfSentence > 1)
            return this.nodes.length-this.firstIndexOfSentence-1;
      else
            return 0;
 },

 clearAll: function() {
      this.sentences = [];
      this.nodes = [];
      this.sposNum = 0;
      this.firstIndexOfSentence = 0;
 }

};








  </script>
